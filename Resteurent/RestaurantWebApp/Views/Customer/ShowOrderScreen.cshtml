@using LiolamResteurent
@using RestaurantWebApplication.externals
@model Order

@{
    ViewData["Title"] = "ShowOrderScreen";
    Layout = "~/Views/Shared/MasterPage.cshtml";
    List<string> prevOrders = Context.Session.GetObject<List<string>>("prevOrders");
}

@section Styles
{
<link href="~/css/customer/order.css" rel="stylesheet" />
}
@section Js
{
<script src="~/javascript/customer/order.js"></script>
}

@if (ViewBag.Error == true)
{
    <div class="order-message error">
        <h2>Order Failed</h2>
        <p>sorder must contains one dish at list</p>
    </div>
}
else
{
    <div class="order-container">
        <h2>Online Order</h2>

        <div class="order-header">
            Order Number: @Model.Id
        </div>

        <div class="dishes-list">
            @if (Model.products != null)
            {
                foreach (var product in Model.products)
                {
                    <div class="dish-item">
                        <img src="@product.Image" alt="Dish Image" class="dish-image" />
                        <span class="dish-name">@product.Name</span>
                        <input id="dish-quantity_@product.Id" class="dish-quantity" type="number" min="1" max="10" value="@product.Quatity" onchange="updateQuantity('@product.Id')" />
                        <span id="total_price_@product.Id" class="dish-price">@product.totalPrice.ToString()</span>
                        <a class="remove-button" href="https://localhost:7287/customer/RemoveDishFromOrder?dishId=@product.Id">-</a>
                    </div>
                }
            }
        </div>

        <div class="add-dish-container">
            <a class="add-button" href="https://localhost:7287/customer/ShowOrderMenu">+</a>
        </div>

        <div class="sum-box" id="sum-box">
            Sum: @(Model.products?.Sum(d => d.totalPrice) ?? 0) $
        </div>

        <div class="action-buttons">
            <a class="pay-button" href="https://localhost:7287/customer/ShowCreditCardInfo">Pay</a>
            <form action="https://localhost:7287/customer/LoadOrderById" method="get" class="load-form">
                @if (prevOrders != null && prevOrders.Count > 0)
                {
                    <select name="orderId" class="load-input" required>
                        <option value="">Select a previous order</option>
                        @foreach (var orderId in prevOrders)
                        {
                            <option value="@orderId">#@orderId</option>
                        }
                    </select>
                    <button type="submit" class="load-button">Load Order</button>
                }
                else
                {
                    <input type="text" class="load-input readonly" value="No previous orders available" readonly />
                    <button class="load-button" disabled>Load Order</button>
                }
            </form>
        </div>
    </div>
}

